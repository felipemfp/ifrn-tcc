\chapter{Modelo Espaço-Temporal}
\label{chap:modelo}

\todo{"Você precisa definir primeiramente um polígono através de imagens"}

\todo{"Através de uma sequência de imagens, mostre como você usa o conceito de polígonos para crir as IDRs e depois sobrepor durante o tempo para identificar as diferências"}

Neste capítulo, entendemos o que são as chamadas Regiões Densas Interessantes e definimos o modelo espaço-temporal e sua aplicabilidade.

\section{Regiões Densas Interessantes}

\abrv[IDR \qquad Interesting Dense Region]{}

Uma Região Densa Interessante (do inglês {\em Interesting Dense Region}, IDR) é uma região espacial com uma alta probabilidade de conter pontos de interesse do analista. IDR são coletadas e definidas durante o processamento do feedback do usuário. Diferentemente da literatura que predominantemente foca em interações explícitas, como clicar no botão, investigamos o feedback implícito.

Durante a exploração iterativa de dados espaciais, é comum o caso que o analista avalia algumas regiões de interesse, mas esquece de dá um feedback explícito sobre aquela região. O ato do usuário olhar para essa região pode ser capturado através do rastreio da movimentos oculares e, como \citeonline{arapakis2014user} comprova, esse método possui uma forte relação com a atenção do usuário.

Entretanto o rastreamento dos movimentos oculares fere várias questões de privacidade, assim sendo optamos pela alternativa de rastrear os deslocamentos do cursor do mouse. \citeonline{arapakis2014understanding} argumenta que esse método possui uma forte relação com o engajamento do usuário. Intuitivamente, um ponto espacial recebe um feedback positivo se o cursor do mouse se desloca próximo a ele frequentemente.

O objetivo de descobrir IDRs é para obter preferências do analista que nunca foram expressadas explicitamente. Para tal, baseamos em dois conceitos:

\begin{itemize}
	\item \textbf{Conceito 1}: uma região é mais interessante ao analista, se for densa. Por exemplo, o analista movimenta seu mouse naquela região várias vezes.
	\item \textbf{Conceito 2}: é possível que o analista movimente seu mouse em qualquer lugar do mapa. Isso não deve significar que todo lugar no mapa tem a mesma significância.
\end{itemize}

Com base nesses conceitos, o processo de descobrimento das IDRs pode ser descrito pelo Algoritmo \ref{algo:idr}. Adicionamos pontos para $\mathcal{M}$ a cada $200ms$ para evitar pontos redundantes. De acordo com Conceito 1 e com o próposito de identificar comportamentos recorrentes, o algoritmo começa particionando $\mathcal{M}$ em $g$ segmentos consecutivos $\mathcal{M_0}$ até $\mathcal{M_g}$. O primeiro segmento começa no momento zero (quando a iteração iniciou) e o último termina em $t_c$, ou seja, no tempo atual que o algoritmo é executado. De acordo com o Conceito 2, encontramos os clusters em cada segmento de $\mathcal{M}$ usando uma variação da abordagem DB-SCAN \cite{Ester:1996}. Por fim, encontramos e retornamos as interseções desses clusters como IDRs.

\begin{algorithm}[t]
	\DontPrintSemicolon
	\KwIn{Tempo atual $t_c$, pontos dos movimentos do mouse $\mathcal{M}$}
	\KwOut{IDRs encontradas $\mathcal{S}$}
	$\mathcal{S} \gets \emptyset$\;
	$g \gets ${\em número de segmentos}\;
	\For{$i \in [0,g]$}
	{
		   $\mathcal{M}_i \gets \{m = \langle x,y,t \rangle | (\frac{t_c}{g} \times i) \leq t \leq (\frac{t_c}{g} \times (i+1))\}$\;
		   $\mathcal{C}_i \gets \mathit{mine\_clusters}(\mathcal{M}_i)$\label{ln:mine}\;
		   $\mathcal{O}_i \gets \mathit{find\_polygons}(\mathcal{C}_i)$\label{ln:poly}\;
	}
	\lFor{$\mathcal{O}_i, \mathcal{O}_j$ onde $i,j \in [0,g]$ e $i \neq j$}
	{
		   $\mathcal{S}.\mathit{append}(\mathit{intersect}(\mathcal{O}_i, \mathcal{O}_j))$
	}
	% $\mathcal{H} \gets \mathit{discover\_highlights}(\mathcal{S},k)$\label{ln:geoguide}\;
	\Return{$\mathcal{S}$}\; 
	\caption{Descobrimento de IDRs}
	\label{algo:idr}
\end{algorithm}

Para clusterizar os pontos em cada segmento de tempo (linha \ref{ln:mine} do Algoritmo \ref{algo:idr}), usamos ST-DBSCAN, uma variação do DB-SCAN que leva em consideração atributos espaciais e temporais para clusterizar pontos com base na densidade \cite{Birant:2007}. Para cada subconjunto de pontos dos movimentos do mouse $\mathcal{M}_i$, $i \in [0,g]$, ST-DBSCAN começa com um ponto aleatório $m_0 \in \mathcal{M}_i$ e coleta todos os pontos alcançaveis (de acordo com a densidade) de $m_0$ usando uma métrica de distância. Como os pontos dos movimentos do mouse ocorrem em um espaço bidimensional (ou seja, monitor do computador), optamos por usar a distância euclidiana como nossa métrica. Se $m_0$ for identificado como objeto {\em core}, uma cluster será gerado. Caso contrário, se $m_0$ é uma objeto de borda, nenhum ponto é alcançável de $m_0$ e o algoritmo buscará outro ponto aleatório em $\mathcal{M}_i$. Esse processo é repetido até que todos os pontos sejam processados.

Uma vez que os clusters são formados para cada subconjunto de $\mathcal{M}$, encontramos suas interseções para determinar as regiões recorrentes. Para obter as interseções, precisamos definir nitidamente as fronteiras dos clusters (linha \ref{ln:poly}). Portanto para cada cluster, nós encontramos seu respectivo polígono que engloba todos os pontos. Para isso, utilizamos o algoritmo Quickhull, um método, com abordagem similar ao Quicksort, que calcula o invólucro convexo para um determinado conjunto de pontos num plano bidimensional \cite{Barber:1996}.

Esse algoritmo de descoberta de IDR é executado a cada $t$ intervalo de tempo durante uma análise exploratória. Dessa forma, enquanto o analista está explorando o conjunto de dados, nosso sistema está coletando de maneira transparente suas preferências. Na Figura \ref{fig:descoberta-idr}, vemos uma iteração de coleta e execução desse algoritmo onde $g = 3$, ou seja, o feedback é coletado em 3 segmentos diferentes de tempo. Os movimentos do mouse realizados pelo analista nesses 3 segmentos são demostrados na Figura \ref{fig:descoberta-idr}.A. Para cada segmento, os pontos coletados dos movimentos do mouse são clusterizados e convertidos em polígonos convexos (Figura \ref{fig:descoberta-idr}.B-D, respectivamente). Por fim, os polígonos são sobrepostos (Figura \ref{fig:descoberta-idr}.E) e as interseções encontradas são definidas como IDRs (IDR1-4 na Figura \ref{fig:descoberta-idr}.F).

\begin{figure}[t]
	\centering
	\includegraphics[width=\textwidth]{imagens/regions}
	\caption{Processo de Descoberta de IDRs.}
	\label{fig:descoberta-idr}
\end{figure}

% Há diversas abordagem para inferir uma região espacial para um determinado conjunto de pontos \cite{Bevis1989,DUCKHAM2008,FADILI2004,ARAMPATZIS2006,Galton2006}. A abordagem comum é agregar os pontos na forma de polígonos côncavos e convexos. Na construção de um polígono côncavo, as concavidades de um polígono pode conter pontos que não estão necessariamente presentes em $\mathcal{M}$. No algoritmo de descoberta de IDR, adaptamos o uso do Quickhull \cite{Barber:1996}, por causa da sua simplicidade, eficiência e sua implementação natural de polígonos convexos.

\subsection{Perfil}

Uma IDR descreve uma região espacial no conjunto de dados do analista coletada num determinado tempo $t$. Cada região representa as preferências do analista no momento $t$ no contexto espacial, ou seja, {\em onde} o analista está interessado. Para entender, {\em em quê} o analista está interessado, em outras palavras, as preferências sobre o contexto de domínio, definimos o perfil de cada região.

\begin{table}[]
	\centering
	\begin{tabular}{|l|l|}
		\hline
		\textbf{id}                  & 15                             \\ \hline
		\textbf{latitude}            & 48.88880                       \\ \hline
		\textbf{longitude}           & 2.320465                       \\ \hline
		\textbf{name}                & Nice appartment in Batignolles \\ \hline
		\textbf{host\_name}          & Daniele                        \\ \hline
		\textbf{neighbourhood}       & Batignolles-Monceau            \\ \hline
		\textbf{room\_type}          & Entire home/apt                \\ \hline
		\textbf{price}               & 65                             \\ \hline
		\textbf{minimun\_nights}     & 1                              \\ \hline
		\textbf{stars}               & 4                              \\ \hline
		\textbf{number\_of\_reviews} & 25                             \\ \hline
		\textbf{reviews\_per\_month} & 1.74                           \\ \hline
		\textbf{availability\_365}   & 35                             \\ \hline
		\textbf{last\_review}        & 2015-11-14T09:07:02+00:00      \\ \hline
	\end{tabular}
	\caption{Exemplo de atributos de um ponto que representa uma estadia}
	\label{table:atributos}
\end{table}

O perfil é a sumarização dos atributos dos pontos contidos numa IDR. Cada ponto em um conjunto de dados ($p \in \mathcal{P}$) é descrito por suas coordenadas espaciais e uma série de atributos de domínio $dom(p)$. A Tabela \ref{table:atributos} apresenta um exemplo dos atributos de um ponto no conjunto de dados do Airbnb.

Na Tabela \ref{table:atributos}, os atributos {\em latitude} e {\em longitude} são as coordenadas espaciais, enquanto que todos os outros atributos caracterizam os atributos de domínio. Dentre os atributos de domínio, podemos encontrar 4 tipos de dados:

\begin{enumerate}
	\item Numéricos: são atributos que representam valores numéricos, como, por exemplo, os atributos {\em price}, {\em minimun\_nights}, {\em number\_of\_reviews}, {\em reviews\_per\_month} e {\em availability\_365}.
	\item Textuais: são atributos que representam valores textuais, como, por exemplo, os atributos {\em name} e {\em host\_name}.
	\item Categóricos: são atributos que representam valores tanto numéricos, quanto textuais, mas que se repetem pouco em todo o conjunto. Por exemplo, o atributo {\em stars} possue apenas cinco valores em todo o conjunto. Os atributos {\em room\_type} e {\em neighbourhood} também possuem um número finito de opções, por isso são classificados como categóricos.
	\item Temporais: são atributos que representam data e/ou hora de um determinado evento, como, por exemplo, o atributo {\em last\_review} que representa quando foi publicado a última avaliação.
\end{enumerate}

Esses 4 tipos são comumente encontrados em conjuntos de dados espacias, portanto o perfil da IDR precisa representar de maneira resumida esses atributos em relação aos pontos nela contidos. Assim sendo, tratamos cada tipo de acordo com sua especificidade:

\begin{table}[]
	\centering
	\begin{tabular}{|l|r|r|r|r|r|}
	\hline
	\multicolumn{1}{|c|}{\textbf{Atributo}} & \multicolumn{1}{c|}{\textbf{Total}} & \multicolumn{1}{c|}{\textbf{Média}} & \multicolumn{1}{c|}{\textbf{$\sigma$}} & \multicolumn{1}{c|}{\textbf{Mínimo}} & \multicolumn{1}{c|}{\textbf{Máximo}} \\ \hline
	price                                   & 73                                       & 106,68                              & 62,62                                       & 40                                   & 401                                  \\ \hline
	minimun\_nights                         & 73                                       & 2,36                                & 1,60                                        & 1                                    & 7                                    \\ \hline
	number\_of\_reviews                     & 73                                       & 17,86                               & 27,85                                       & 0                                    & 120                                  \\ \hline
	reviews\_per\_month                     & 55                                       & 1,64                                & 1,53                                        & 0,08                                 & 7,27                                 \\ \hline
	calculated\_host\_listings\_count       & 73                                       & 4,05                                & 10,83                                       & 1                                    & 56                                   \\ \hline
	availability\_365                       & 73                                       & 179,64                              & 154,48                                      & 0                                    & 365                                  \\ \hline
	\end{tabular}
	\caption{Exemplo de perfil dos atributos numéricos de uma IDR}
	\label{table:perfil-numericos}
\end{table}

\begin{table}[]
	\centering
	\begin{tabular}{|l|r|}
	\hline
	\multicolumn{2}{|c|}{\textbf{Atributo: name}} \\ \hline
	\textbf{Termo}     & \textbf{Ocorrências}     \\ \hline
	champs             & 29                       \\ \hline
	elysées            & 18                       \\ \hline
	studio             & 14                       \\ \hline
	near               & 13                       \\ \hline
	flat               & 11                       \\ \hline
	\end{tabular}
	\caption{Exemplo parcial de perfil do atributo textual de uma IDR}
	\label{table:perfil-textual}
\end{table}

\begin{table}[]
	\centering
	\begin{tabular}{|l|r|}
	\hline
	\textbf{Categoria}                                            & \textbf{Quantidade} \\ \hline
	\textless{}neighbourhood, "Batignolles-Monceau"\textgreater{} & 73                  \\ \hline
	\textless{}room\_type, "Entire home/apt"\textgreater{}        & 69                  \\ \hline
	\textless{}room\_type, "Private room"\textgreater{}           & 4                   \\ \hline
	\textless{}stars, 1\textgreater{}                             & 6                   \\ \hline
	\textless{}stars, 2\textgreater{}                             & 7                   \\ \hline
	\textless{}stars, 3\textgreater{}                             & 29                  \\ \hline
	\textless{}stars, 4\textgreater{}                             & 20                  \\ \hline
	\textless{}stars, 5\textgreater{}                             & 11                  \\ \hline
	\end{tabular}
	\caption{Exemplo de perfil dos atributos categóricos de uma IDR}
	\label{table:perfil-categoricos}
\end{table}

\begin{enumerate}
	\item Numéricos: os atributos números encontrados em uma IDR são sumarizados usando funções estatísticas como média, desvio padrão, mínimo e máximo. Podemos ver um exemplo do resultado dessa sumarização na Tabela \ref{table:perfil-numericos}.

	\item Textuais: os atributos textos são tratados separadamente. Para cada atributo, é feito o levantamento dos termos mais usados. Essa abordagem é utilizado por \citeonline{kumar2017} para encontrar os termos mais usados no contexto temporal. A Tabela \ref{table:perfil-textual} apresenta os 5 primeiros resultados para o atributo {\em name} em uma IDR.

	\item Categóricos: os atributos categóricos são contabilizados num dicionário $M$ onde as chaves são uma tupla com o nome do atributo e o valor da categoria. Quanto maior a quantidade de repetições de uma categoria, mais relevante no contexto de uma IDR. A Figura \ref{table:perfil-categoricos} mostra o resultado num conjunto de dados para os atributos {\em neighbourhood}, {\em room\_type} e {\em stars}.

	\item Temporais: os atributos temporais são normalizados para uma escala linear (a partir do ano novo para datas e a partir da meia noite para horas) a fim de ser contabilizado as ocorrências. Por exemplo, uma atributo com a data {\em 2018-12-21} é normalizado para {\em 2018, 12, 355}, isto é, numa linha temporal esse evento ocorreu no ano 2018, no 12º mês e no 355º dia. As horas são normalizados de maneira similiar, a hora {\em 08:33:22} é normalizado para {\em 8, 513, 30802}, isto é, esse evento ocorreu na 8º hora, 513º minuto e 30802º segundo. Com os valores normalizadas, podemos encontrar os dias e os momentos do dia mais recorrentes para determinado evento na IDR.
\end{enumerate}


\section{Modelo Temporal}

Cada IDR é coletado num momento $t$ e seu perfil definido através dos atributos de domínio dos pontos contidos na região delimitada. Dessa forma, para cada momento $t$ em qualquer espaço de tempo, sabemos as preferências do usuário tanto no contexto espacial quanto no contexto de domínio.

O perfil pode ser definido para cada IDR, mas também para um conjunto de IDRs, ou seja, é possível realizar a análise das preferências do analista em qualquer espaço de tempo (minutos, horas, dias, semanas etc).

Assim sendo é através das IDRs coletadas que podemos aplicar a análise temporal e evoluir o sistema de destacamente de informação do GeoGuide.

\section{Contexto Espacial}

O contexto espacial se refere aos aspectos geográficos como, por exemplo, em que parte da cidade o analista se interessa.

\begin{figure}[t]
	\centering
	\includegraphics[width=\textwidth]{imagens/analise-contexto-espacial}
	\caption{Evolução no contexto espacial.}
	\label{fig:analise-contexto-espacial}
\end{figure}

\section{Contexto de Domínio}

O contexto de domínio se refere aos aspectos de domínio como, por exemplo, se o analista tem mais interesse em casas com varanda ou apartamentos.